<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
    <link rel="manifest" href="../../site.webmanifest">
    <link rel="shortcut icon" href="../../favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Mortgage Calculator | Solveria</title>

    <meta name="description" content="Estimate your monthly mortgage payment with our comprehensive calculator. See a full breakdown of principal, interest, taxes, and insurance (PITI) and view your amortization schedule.">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebPage",
          "@id": "https://solveria.org/financial-calculators/mortgage-calculator/",
          "url": "https://solveria.org/financial-calculators/mortgage-calculator/",
          "name": "Mortgage Calculator",
          "description": "An essential tool that estimates your monthly payment and the total cost of your loan based on variables like home price, down payment, interest rate, and loan term.",
          "publisher": {
            "@id": "https://solveria.org/#organization"
          },
          "breadcrumb": {
            "@id": "https://solveria.org/financial-calculators/mortgage-calculator/#breadcrumb"
          },
          "mainEntity": [
            { "@id": "https://solveria.org/financial-calculators/mortgage-calculator/#howto" },
            { "@id": "https://solveria.org/financial-calculators/mortgage-calculator/#faq" }
          ]
        },
        {
          "@type": "Organization",
          "@id": "https://solveria.org/#organization",
          "name": "Solveria",
          "url": "https://solveria.org/",
          "logo": {
            "@type": "ImageObject",
            "url": "https://solveria.org/img/Logo_Golden.png"
          }
        },
        {
          "@type": "BreadcrumbList",
          "@id": "https://solveria.org/financial-calculators/mortgage-calculator/#breadcrumb",
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": "https://solveria.org/"
            },
            {
              "@type": "ListItem",
              "position": 2,
              "name": "Calculators",
              "item": "https://solveria.org/calculators/"
            },
            {
              "@type": "ListItem",
              "position": 3,
              "name": "Mortgage Calculator"
            }
          ]
        },
        {
          "@type": "HowTo",
          "@id": "https://solveria.org/financial-calculators/mortgage-calculator/#howto",
          "name": "How to Use Our Mortgage Calculator",
          "description": "To get the most accurate estimate, follow these steps:",
          "step": [
            {
              "@type": "HowToStep",
              "name": "Enter Home Price",
              "text": "Input the total purchase price of the property youâ€™re considering."
            },
            {
              "@type": "HowToStep",
              "name": "Provide Down Payment",
              "text": "Enter the amount of cash you will pay upfront. A larger down payment reduces your loan amount and can help you avoid Private Mortgage Insurance (PMI)."
            },
            {
              "@type": "HowToStep",
              "name": "Select Loan Term",
              "text": "Choose the length of your loan, typically 15 or 30 years. Shorter terms have higher monthly payments but save significantly on total interest."
            },
            {
              "@type": "HowToStep",
              "name": "Set the Interest Rate",
              "text": "Enter the Annual Percentage Rate (APR) from your lender. Even small changes here can dramatically impact your total cost."
            },
            {
              "@type": "HowToStep",
              "name": "Choose a Start Date",
              "text": "Select the month and year your loan is expected to begin to generate an accurate amortization schedule."
            },
            {
              "@type": "HowToStep",
              "name": "Add Annual Housing Costs",
              "text": "Enter estimates for your yearly property taxes and homeowners insurance. These are often paid monthly via an escrow account."
            },
            {
              "@type": "HowToStep",
              "name": "Include Other Fees",
              "text": "Add any monthly Private Mortgage Insurance (PMI) if your down payment is below 20%, as well as any Homeowners Association (HOA) fees."
            },
            {
              "@type": "HowToStep",
              "name": "Enter Your Financials",
              "text": "Provide your gross monthly income and total recurring monthly debts to calculate your Debt-to-Income (DTI) ratio."
            }
          ]
        },
        {
          "@type": "FAQPage",
          "@id": "https://solveria.org/financial-calculators/mortgage-calculator/#faq",
          "mainEntity": [
            {
              "@type": "Question",
              "name": "What costs are included in a mortgage payment?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "A mortgage payment typically consists of PITI: Principal, Interest, Taxes, and Insurance. It may also include Private Mortgage Insurance (PMI) if your down payment is less than 20%, plus any monthly HOA fees."
              }
            },
            {
              "@type": "Question",
              "name": "What is the difference between a 15-year and 30-year mortgage?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "A 30-year mortgage offers lower monthly payments but costs more in total interest. A 15-year mortgage has higher monthly payments, but you build equity faster and pay significantly less in total interest."
              }
            },
            {
              "@type": "Question",
              "name": "What is PMI and how can I avoid it?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Private Mortgage Insurance (PMI) protects the lender if your down payment is less than 20%. You can avoid it by making a larger down payment. PMI is usually removed once your home equity reaches 20%."
              }
            },
            {
              "@type": "Question",
              "name": "What is 'cash to close'?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "\"Cash to close\" is the total amount of money you need on closing day. It includes your down payment plus closing costs (e.g., appraisal fees, title insurance, loan origination fees)."
              }
            },
            {
              "@type": "Question",
              "name": "What is a DTI ratio and why is it important?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "Your Debt-to-Income (DTI) ratio compares your total monthly debts to your gross monthly income. Lenders view it as a key indicator of your ability to manage payments, and a lower DTI can improve your chances of approval and help you secure better loan terms."
              }
            },
            {
              "@type": "Question",
              "name": "How can I reduce the total interest I pay on my mortgage?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "You can reduce total interest by making extra principal payments, choosing a shorter loan term, improving your credit score to get a lower rate, or refinancing if interest rates drop."
              }
            },
            {
              "@type": "Question",
              "name": "Does this calculator guarantee loan approval?",
              "acceptedAnswer": {
                "@type": "Answer",
                "text": "No. This tool provides a reliable estimate for planning purposes. Final loan approval and terms depend on a lender's formal underwriting process, which includes verifying your credit, income, assets, and the property appraisal."
              }
            }
          ]
        }
      ]
    }
    </script>
    <style>
        /* All CSS from your file... */
        html {
            scroll-behavior: smooth;
        }
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            background-color: #f4f4f4;
            color: #333;
            font-weight: 300; 
        }
        strong, b {
            font-weight: 300;
        }
        .hero-section {
            height: 100vh;
            background-image: url('../../img/Home_MC.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            padding-bottom: 10vh;
            position: relative; 
            overflow: hidden;
        }
        .hero-nav {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 40px;
            z-index: 10;
        }
        .hero-nav a {
            color: #cacaca;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 300;
            transition: color 0.3s ease;
        }
        .hero-nav a:hover {
            color: #ffffff;
        }
        .hero-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: white;
        }
        .hero-content-wrapper img {
            width: 200px;
            height: 200px;
            margin-bottom: 25px;
        }
        .hero-section h1 {
            color: #ffffff;
            font-size: 5.5rem;
            font-weight: 100; 
            text-align: center;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.7);
            margin: 0; 
        }
        .hero-tagline {
            height: 40px; 
            margin-top: 15px;
        }
        .hero-tagline p {
            margin: 0;
            color: #e0e0e0;
            font-size: 1.25rem;
            font-weight: 100;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.7);
            text-align: center;
            opacity: 0; 
            transition: opacity 1.5s ease-in-out;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transform: translateZ(0);
        }
        .scroll-indicator {
            position: absolute;
            bottom: 40px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            cursor: pointer;
            transition: left 0.5s ease-in-out;
        }
        .scroll-indicator img {
            width: 30px;
            height: auto;
            flex-shrink: 0;
        }
        .scroll-indicator p {
            margin: 0;
            color: #e0e0e0;
            font-size: 1rem;
            font-weight: 300;
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            white-space: nowrap;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transform: translateZ(0);
        }
        .mobile-nav {
            display: none;
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            gap: 40px;
        }
        .mobile-nav-link {
            color: #cacaca;
            text-decoration: none;
            font-size: 1rem;
            font-weight: 300;
            transition: color 0.3s ease;
        }
        .mobile-nav-link:hover {
            color: #ffffff;
        }
        .content-section {
            padding: 120px 20px 50px;
            box-sizing: border-box;
        }
        .calculator-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 60px;
            align-items: baseline;
            position: relative;
        }
        .breadcrumb {
            position: absolute;
            top: -60px;
            left: -4px;
            color: #777777;
            font-size: 0.9rem;
            font-weight: 300; 
        }
        .breadcrumb a {
            color: inherit;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .breadcrumb a:hover {
            color: #000000;
        }
        .breadcrumb span {
            color: #333;
            font-weight: 400;
        }
        .intro-section {
            grid-column: 1 / -1;
            margin-bottom: 0;
            margin-top: 20px;
        }
        .intro-section h2 {
            font-size: 4rem;
            font-weight: 100; 
            color: #333;
            margin-top: 0;
            margin-bottom: 20px;
            margin-left: -4px;
        }
        .intro-section p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #555;
            max-width: 900px;
        }
        .calculator-container h2, .results-container h2 {
            font-size: 4rem;
            font-weight: 100; 
            color: #333;
            margin-top: 0;
            margin-bottom: 40px;
            line-height: 1.1; 
            margin-left: -4px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px 80px;
        }
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }
        .input-group label {
            display: block;
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 5px;
            pointer-events: none;
        }
        .input-group .date-sub-label {
            font-size: 0.8rem;
        }
        .input-group input[type="text"],
        .input-group input[type="number"],
        .input-group select {
            width: 100%;
            padding: 8px 0;
            border: none;
            border-bottom: 1px solid #ccc;
            font-size: 1.1rem;
            color: #333;
            background-color: transparent;
            outline: none;
            font-weight: 300; 
            transition: border-bottom-color 0.3s ease;
            appearance: none;
        }
        .input-group input[type="text"]:focus,
        .input-group input[type="number"]:focus,
        .input-group select:focus {
            border-bottom-color: #666;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .date-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .date-inputs .input-group {
            margin-bottom: 0;
        }
        .custom-select-wrapper {
            position: relative;
            font-size: 1.1rem;
            font-weight: 300;
            user-select: none;
        }
        .custom-select-wrapper select {
            display: none; 
        }
        .select-selected {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
            color: #333;
            padding: 12px 40px 12px 15px;
            cursor: pointer;
            position: relative;
        }
        .select-selected::after { 
            position: absolute;
            content: "";
            top: 50%;
            right: 18px;
            width: 0;
            height: 0;
            margin-top: -3px;
            border: 6px solid transparent;
            border-color: #666 transparent transparent transparent;
            transition: all 0.2s ease;
        }
        .select-selected.select-arrow-active::after { 
            transform: rotate(180deg);
            margin-top: -9px;
        }
        .select-items {
            position: absolute;
            background-color: white;
            top: calc(100% + 6px);
            left: 0;
            right: 0;
            z-index: 99;
            border-radius: 8px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
            border: none; 
            overflow: hidden; 
        }
        .select-hide {
            display: none;
        }
        .select-items div {
            color: #333;
            padding: 12px 15px;
            cursor: pointer;
            transition: background-color 0.1s ease;
        }
        .select-items div:hover {
            background-color: #f4f4f4; 
        }
        .same-as-selected {
            background-color: #ebebeb; 
        }
        .results-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 20px;
            margin-bottom: 0;
            text-align: left;
        }
        .summary-item span { display: block; }
        .summary-item .label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        .summary-item .value {
            font-size: 1.5rem;
            font-weight: 300; 
            color: #333;
        }
         .summary-item .value.dti-value {
            font-size: 1.8rem;
        }
        .summary-text {
            margin-top: 60px;
        }
        .summary-text h3 {
            font-size: 1.8rem;
            font-weight: 300; 
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 0;
        }
        .summary-text p {
            font-size: 1rem;
            line-height: 1.6;
            color: #555;
            margin-bottom: 0;
        }
        #contextual-advice {
            margin-top: 20px;
        }
        .summary-highlight {
            font-weight: 300; 
        }
        .breakdown-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            margin-top: 60px;
        }
        .breakdown-section h3 {
            font-size: 1.8rem;
            font-weight: 300; 
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 20px;
            margin-top: 0;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            font-size: 1rem;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .result-item:last-child { border-bottom: none; }
        .result-item .label { color: #666; }
        .result-item .value {
            font-weight: 300; 
        }
        .related-tools-section {
            margin-top: 60px;
        }
        .related-tools-grid {
            display: flex;
            gap: 40px;
        }
        .related-tool-link {
            display: block;
            text-decoration: none;
            margin-top: 25px;
            flex: 1;
        }
        .related-tool-link .link-text {
            color: #333;
            font-size: 1.4rem;
            font-weight: 300;
            transition: color 0.3s ease;
        }
        .related-tool-link:hover .link-text {
            color: #000;
        }
        .related-tool-link .note {
            display: block;
            font-size: 0.9rem;
            color: #777;
            margin-top: 5px;
            font-weight: 300;
            opacity: 0;
            height: 1.2em;
            transition: opacity 1.5s ease-in-out;
        }
        .charts-container {
            max-width: 1400px;
            margin: 80px auto 0;
            display: grid;
            grid-template-columns: 1fr; 
            gap: 80px;
            padding-top: 40px;
        }
        .line-charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 80px;
        }
        .chart-wrapper {
            width: 100%;
            text-align: center;
        }
        .chart-wrapper h2 {
            font-size: 2.5rem;
            font-weight: 100; 
            color: #333;
            margin-top: 0;
            margin-bottom: 30px;
        }
        .pie-chart-container {
            max-width: 320px;
            margin: 0 auto;
            position: relative;
        }
        .custom-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px 20px;
            margin-top: 20px;
            font-size: 0.85rem;
        }
        .legend-item {
            display: flex;
            align-items: center;
        }
        .legend-color-box {
            width: 12px;
            height: 12px;
            margin-right: 8px;
            border-radius: 2px;
        }
        .chart-tooltip {
            position: absolute;
            background-color: rgb(255, 255, 255);
            border-radius: 8px;
            padding: 10px 15px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.15s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            font-weight: 300;
            font-size: 0.9rem;
            z-index: 10;
            text-align: left;
            width: 220px;
            box-sizing: border-box; 
        }
        .tooltip-title {
            font-weight: 300; 
            margin-bottom: 8px;
            text-align: center;
        }
        .tooltip-body-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 6px;
        }
        .tooltip-color-box {
            width: 10px;
            height: 10px;
            margin-right: 10px;
            border-radius: 2px;
        }
        .details-button {
            background-color: #ffffff;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-family: 'Roboto', sans-serif;
            font-size: 1rem;
            font-weight: 300;
            color: #333;
            cursor: pointer;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .details-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(240, 240, 240, 0.2);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 15px;
            box-sizing: border-box;
        }
        .modal-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle at center, rgba(0,0,0,0) 0%, rgba(0,0,0,0.25) 100%);
            z-index: 1;
        }
        .modal-content {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 30px 40px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
            position: relative;
            width: 100%;
            max-width: 500px;
            z-index: 2;
        }
        .modal-header {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 25px;
        }
        .modal-content h3 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 300;
            text-align: center;
        }
        .modal-close-btn {
            position: absolute;
            top: 50%;
            right: -15px;
            transform: translateY(-50%);
            background: none;
            border: none;
            font-size: 2.2rem;
            font-weight: 300;
            color: #888;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            transition: color 0.2s ease;
        }
        .modal-close-btn:hover {
            color: #333;
        }
        .modal-breakdown-container .result-item {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            align-items: center;
            gap: 15px;
        }
        .modal-breakdown-container .result-item .label {
            text-align: left;
        }
        .modal-breakdown-container .result-item .percentage {
            text-align: right;
            font-weight: 400;
            color: #333;
        }
        .modal-breakdown-container .result-item .value {
            text-align: right;
        }
        .modal-breakdown-header {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 15px;
            font-size: 0.9rem;
            color: #777;
            padding-bottom: 8px;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .modal-breakdown-header span:nth-child(2),
        .modal-breakdown-header span:nth-child(3) {
            text-align: right;
        }
        .amortization-schedule-container {
            max-width: 1400px;
            margin: 100px auto 50px;
            text-align: center;
        }
        .amortization-schedule-container h2 {
            font-size: 2.5rem;
            font-weight: 100; 
            color: #333;
            margin-top: 0;
            margin-bottom: 30px;
        }
        .toggle-buttons {
            display: inline-flex;
            background-color: #ffffff;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07);
            padding: 5px;
            gap: 5px;
            margin-bottom: 30px;
        }
        .toggle-buttons button {
            padding: 8px 25px;
            font-size: 0.9rem;
            font-weight: 300;
            border: none;
            background-color: transparent;
            color: #333;
            cursor: pointer;
            border-radius: 20px;
            transition: all 0.3s ease-in-out;
        }
        .toggle-buttons button.active {
            background-color: #8c5a3c;
            color: #fff;
            box-shadow: 0 2px 8px rgba(140, 90, 60, 0.4);
        }
        .schedule-table-wrapper {
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 4px;
            scrollbar-width: thin;
            scrollbar-color: #8c5a3c #f1f1f1;
        }
        .schedule-table-wrapper::-webkit-scrollbar {
            width: 8px;
        }
        .schedule-table-wrapper::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .schedule-table-wrapper::-webkit-scrollbar-thumb {
            background-color: #8c5a3c;
            border-radius: 10px;
        }
        .schedule-table-wrapper::-webkit-scrollbar-button {
            display: none; 
        }
        .amortization-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }
        .amortization-table th, .amortization-table td {
            padding: 12px 15px;
            text-align: right;
        }
        .amortization-table th {
            background-color: #ffffff;
            border-bottom: 2px solid #eee;
            font-weight: 300; 
            color: #444;
            position: sticky;
            top: 0;
        }
        .amortization-table td {
            border-top: 1px solid #eee;
            color: #555;
        }
         .amortization-table tr:nth-child(even) td {
            background-color: #fcfcfc;
        }
        .amortization-table th:first-child, .amortization-table td:first-child {
            text-align: left;
            font-weight: 300; 
        }
        .amortization-table th:nth-child(2), .amortization-table td:nth-child(2) {
            text-align: left;
        }
        .seo-content-section {
            max-width: 1400px; 
            margin: 100px auto 50px;
            padding: 0; 
            text-align: left;
        }
        .seo-content-section h2 {
            font-size: 2.5rem;
            font-weight: 100; 
            color: #333;
            margin-top: 60px;
            margin-bottom: 20px;
        }
        .seo-content-section p, .seo-content-section li, .seo-content-section ul {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #555;
            padding-left: 0;
            list-style-position: inside;
        }
        .seo-content-section ol {
            list-style: none;
            padding-left: 0;
            counter-reset: guide-counter;
        }
        .seo-content-section ol li {
            counter-increment: guide-counter;
            margin-bottom: 25px;
            position: relative;
            padding-left: 40px;
        }
        .seo-content-section ol li::before {
            content: counter(guide-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #e9e9e9;
            border: 1px solid #ddd;
            box-sizing: border-box;
            color: #555;
            font-weight: 300; 
            text-align: center;
            line-height: 26px; 
            font-size: 0.9rem;
        }
        .faq-section details {
            border-bottom: 1px solid #e0e0e0;
            padding: 20px 0;
        }
        .faq-section summary {
            font-size: 1.2rem;
            font-weight: 300; 
            color: #333;
            cursor: pointer;
            list-style: none;
            position: relative;
            padding-right: 30px;
        }
        .faq-section summary::-webkit-details-marker {
            display: none;
        }
        .faq-section summary::after {
            content: '+';
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            font-weight: 300;
            color: #888;
            transition: transform 0.2s ease;
        }
        .faq-section details[open] summary::after {
            transform: translateY(-50%) rotate(45deg);
        }
        .faq-section .faq-answer {
            padding: 15px 5px 0;
            color: #555;
            line-height: 1.7;
            font-size: 1.1rem;
        }
        footer {
            padding: 100px 20px 40px;
            background: linear-gradient(to top, #eae5df 20%, transparent);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        footer a {
            color: #777777;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 300;
            transition: color 0.3s ease;
        }
        footer a:hover {
            color: #000000;
        }
        .more-tools-section {
            max-width: 1400px;
            margin: 100px auto 50px;
        }
        .more-tools-section h2 {
            font-size: 2.5rem;
            font-weight: 100;
            color: #333;
            margin-bottom: 30px;
        }
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px;
        }
        .tools-grid h3 {
            font-size: 1.2rem;
            font-weight: 400;
            color: #333;
            margin-top: 0;
            margin-bottom: 20px;
        }
        .links-container a {
            display: block;
            text-decoration: none;
            color: #555;
            font-size: 1rem;
            font-weight: 300;
            margin-bottom: 12px;
            transition: color 0.2s ease;
        }
        .links-container a:hover {
            color: #000;
        }
        .current-tool-item {
            display: block;
            margin-bottom: 12px;
        }
        @media (max-width: 992px) {
            .calculator-wrapper {
                grid-template-columns: 1fr;
                gap: 60px;
                align-items: flex-start; 
            }
            .intro-section {
                margin-bottom: 0;
                margin-top: 0;
            }
             .charts-container, .line-charts-grid {
                grid-template-columns: 1fr;
                gap: 60px;
            }
            .amortization-schedule-container {
                margin-top: 60px;
            }
            .tools-grid {
                grid-template-columns: 1fr 1fr;
            }
            .scroll-indicator p {
                display: none;
            }
            .scroll-indicator {
                left: 50% !important;
                transform: translateX(-50%);
                transition: none !important;
            }
        }
        @media (max-width: 768px) {
            .hero-nav {
                display: none;
            }
            .mobile-nav {
                display: flex;
            }
            .hero-section { padding-bottom: 0; }
            .hero-content-wrapper img {
                width: 160px;
                height: 160px;
                margin-bottom: 15px;
            }
            .hero-section h1 { font-size: 3.5rem; }
            .hero-tagline p { font-size: 1rem; } 
            .content-section { 
                padding: 100px 15px 50px;
            }
            .breadcrumb {
                top: -55px;
                left: 0; 
            }
            .calculator-container h2, .results-container h2, .chart-wrapper h2, .amortization-schedule-container h2, .seo-content-section h2, .more-tools-section h2 {
                font-size: 2.5rem; 
                margin-bottom: 30px;
                line-height: 1.2;
                margin-left: 0;
            }
            .intro-section p, .seo-content-section p, .seo-content-section li, .faq-section .faq-answer, .seo-content-section ul {
                font-size: 1rem;
            }
            .input-grid { grid-template-columns: 1fr; gap: 0; }
            .input-group { margin-bottom: 30px; }
            .date-inputs { gap: 15px; }
            
            .summary-text, .breakdown-container {
                margin-top: 40px;
            }

            .breakdown-container { grid-template-columns: 1fr; gap: 40px; }
            .charts-container { margin-top: 60px; }
            
            .modal-content {
                padding: 20px;
            }
            .modal-header {
                justify-content: space-between;
                margin-bottom: 20px;
            }
            .modal-content h3 {
                font-size: 1.4rem;
                text-align: left;
            }
            .modal-close-btn {
                position: static;
                transform: none;
                padding-left: 15px;
                right: -5px;
                top: 8px;
            }
            .modal-breakdown-container .result-item,
            .modal-breakdown-header {
                grid-template-columns: 1fr 60px 1fr;
                font-size: 0.9rem;
            }

            .seo-content-section, .more-tools-section {
                margin-top: 60px;
                padding: 0;
            }
             .tools-grid {
                grid-template-columns: 1fr;
            }

            .faq-section summary {
                font-size: 1.1rem;
            }
            
            .related-tools-grid {
                display: block;
            }
        }
    </style>
</head>
<body>

    <header class="hero-section">
        
        <div class="mobile-nav">
            <a href="../../" class="mobile-nav-link">Home</a>
            <a href="../../support/" class="mobile-nav-link">Support</a>
        </div>

        <nav class="hero-nav">
            <a href="../../">Home</a>
            <a href="../../support/">Support</a>
            <a href="../../calculators/">Other Finance Calculators</a>
        </nav>
        
        <div class="hero-content-wrapper">
            <picture>
                <source srcset="../../img/Logo_Golden.webp" type="image/webp">
                <source srcset="../../img/Logo_Golden.png" type="image/png">
                <img src="../../img/Logo_Golden.png" alt="Solveria Logo">
            </picture>
            <h1>Mortgage Calculator</h1>
        </div>
        
        <div class="hero-tagline">
            <p id="looping-text"></p>
        </div>

        <a href="#calculator-section" class="scroll-indicator">
            <img src="../../img/Arrow.png" alt="Scroll down arrow">
            <p id="scroll-looping-text"></p>
        </a>
    </header>

    <main class="content-section" id="calculator-section">
        <div class="calculator-wrapper">

            <div class="breadcrumb">
                <a href="../../">Home</a> / <a href="../../calculators/">Financial Calculators</a> / <span>Mortgage Calculator</span>
            </div>

            <div class="intro-section">
                <h2>What is a Mortgage Calculator?</h2>
                <p>Start your home-buying journey with confidence. A mortgage calculator is an essential tool that estimates your monthly payment and the total cost of your loan based on variables like home price, down payment, interest rate, and loan term. It helps you budget for all associated costs, including property taxes, insurance, and potential HOA fees, giving you a clear financial picture before you commit.</p>
            </div>

            <div class="calculator-container">
                <h2>Enter Your Details</h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label for="homePrice">Home Price ($)</label>
                        <input type="text" id="homePrice" value="350000">
                    </div>
                    <div class="input-group">
                        <label for="downPayment">Down Payment ($)</label>
                        <input type="text" id="downPayment" value="70000">
                    </div>
                    <div class="input-group">
                        <label for="loanTerm">Loan Term (Years)</label>
                        <input type="number" id="loanTerm" value="30">
                    </div>
                    <div class="input-group">
                        <label for="interestRate">Interest Rate (%)</label>
                        <input type="text" id="interestRate" value="6.5">
                    </div>
                    <div class="input-group">
                        <label>Start Date</label>
                        <div class="date-inputs">
                            <div class="input-group">
                                <label for="startDateDay" class="date-sub-label">Date</label>
                                <input type="number" id="startDateDay" value="11">
                            </div>
                            <div class="input-group">
                                <label for="startDateMonth" class="date-sub-label">Month</label>
                                <input type="number" id="startDateMonth" value="10">
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="homeInsurance">Home Insurance (Annual $)</label>
                        <input type="text" id="homeInsurance" value="1200">
                    </div>
                    <div class="input-group">
                        <label for="startDateYear" class="date-sub-label">Year</label>
                        <input type="number" id="startDateYear" value="2025">
                    </div>
                     <div class="input-group">
                        <label for="hoaFee">HOA Fee (Monthly $)</label>
                        <input type="text" id="hoaFee" value="150">
                    </div>
                    <div class="input-group">
                        <label for="propertyTaxes">Property Taxes (Annual $)</label>
                        <input type="text" id="propertyTaxes" value="3500">
                    </div>
                    <div class="input-group">
                        <label for="otherCosts">Other Costs (Monthly $)</label>
                        <input type="text" id="otherCosts" value="500">
                    </div>
                    <div class="input-group">
                        <label for="pmiInsurance">PMI Insurance (Annual $)</label>
                        <input type="text" id="pmiInsurance" value="0">
                    </div>
                    <div class="input-group">
                        <label for="monthlyDebts">Total Monthly Debts ($)</label>
                        <input type="text" id="monthlyDebts" value="500">
                    </div>
                    <div class="input-group">
                        <label for="closingCosts">Closing Costs ($)</label>
                        <input type="text" id="closingCosts" value="7000">
                    </div>
                    <div class="input-group">
                        <label for="appreciationRate">Home Value Appreciation (% Annual)</label>
                        <input type="text" id="appreciationRate" value="3">
                    </div>
                    <div class="input-group">
                        <label for="monthlyIncome">Gross Monthly Income ($)</label>
                        <input type="text" id="monthlyIncome" value="8000">
                    </div>
                    <div></div> <div class="input-group">
                        <label for="creditScore">Credit Score Tier</label>
                        <div class="custom-select-wrapper">
                            <select id="creditScore">
                                <option value="excellent">Excellent (760+)</option>
                                <option value="good" selected>Good (700-759)</option>
                                <option value="fair">Fair (640-699)</option>
                                <option value="poor">&lt;640)</option>
                            </select>
                        </div>
                    </div>
                    </div>
            </div>

            <div class="results-container">
                <h2>Your Results</h2>
                <div class="results-summary-grid">
                    <div class="summary-item">
                        <span class="label">Loan Amount</span>
                        <span class="value" id="resultLoanAmount">$0.00</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Total Interest</span>
                        <span class="value" id="resultTotalInterest">$0.00</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Cash to Close</span>
                        <span class="value" id="resultCashToClose">$0.00</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">DTI Ratio</span>
                        <span class="value dti-value" id="resultDtiRatio">0%</span>
                    </div>
                </div>

                <div class="summary-text" id="main-summary">
                    <h3>Summary</h3>
                    <p id="resultSummaryText">Enter your details to see a summary of your mortgage costs.</p>
                    <div id="contextual-advice"></div>
                </div>
                
                <div class="summary-text" id="five-year-summary">
                    <h3>First 5 Years</h3>
                    <p id="fiveYearText">Details about your loan costs in the first five years will appear here.</p>
                </div>
                
                <div class="summary-text related-tools-section">
                    <h3>Related Tools</h3>
                    <div class="related-tools-grid">
                        <a href="../../financial-calculators/home-affordability-calculator/" class="related-tool-link">
                            <span class="link-text">Home Affordability Calculator</span>
                            <span class="note" id="affordability-note"></span>
                        </a>
                        <a href="../../financial-calculators/rent-vs-buy-calculator/" class="related-tool-link">
                            <span class="link-text">Rent v/s Buy Calculator</span>
                            <span class="note" id="rent-buy-note"></span>
                        </a>
                    </div>
                </div>

                <div class="breakdown-container">
                    <div class="breakdown-section" id="monthly-breakdown">
                        <h3>Monthly</h3>
                        <div class="result-item">
                            <span class="label">Mortgage Payment</span>
                            <span class="value" id="monthlyMortgage">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Home Insurance</span>
                            <span class="value" id="monthlyInsurance">$0.00</span>
                        </div>
                         <div class="result-item">
                            <span class="label">HOA Fee</span>
                            <span class="value" id="monthlyHOA">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Total Out-of-Pocket</span>
                            <span class="value" id="monthlyTotal">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Property Tax</span>
                            <span class="value" id="monthlyTax">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">PMI Insurance</span>
                            <span class="value" id="monthlyPMI">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Other Costs</span>
                            <span class="value" id="monthlyOther">$0.00</span>
                        </div>
                    </div>
                    <div class="breakdown-section" id="total-breakdown">
                        <h3>Total</h3>
                        <div class="result-item">
                            <span class="label">Mortgage Payment</span>
                            <span class="value" id="totalMortgage">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Home Insurance</span>
                            <span class="value" id="totalInsurance">$0.00</span>
                        </div>
                         <div class="result-item">
                            <span class="label">HOA Fee</span>
                            <span class="value" id="totalHOA">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Total Out-of-Pocket</span>
                            <span class="value" id="totalTotal">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Property Tax</span>
                            <span class="value" id="totalTax">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">PMI Insurance</span>
                            <span class="value" id="totalPMI">$0.00</span>
                        </div>
                        <div class="result-item">
                            <span class="label">Other Costs</span>
                            <span class="value" id="totalOther">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-wrapper">
                <h2>Lifetime Cost Breakdown</h2>
                <div class="pie-chart-container">
                    <canvas id="costBreakdownChart"></canvas>
                </div>
                <div id="cost-breakdown-legend" class="custom-legend"></div>
                <button id="show-details-btn" class="details-button">More Details</button>
            </div>
            <div class="line-charts-grid">
                <div class="chart-wrapper">
                    <h2>Loan Amortization</h2>
                    <canvas id="loanAmortizationChart"></canvas>
                    <div id="amortization-legend" class="custom-legend"></div>
                </div>
                <div class="chart-wrapper">
                    <h2>Home Equity Timeline</h2>
                    <canvas id="homeEquityChart"></canvas>
                    <div id="equity-legend" class="custom-legend"></div>
                </div>
            </div>
        </div>

        <div class="amortization-schedule-container">
            <h2>Amortization Schedule</h2>
            <div class="toggle-buttons">
                <button id="yearly-btn" class="active">Yearly</button>
                <button id="monthly-btn">Monthly</button>
            </div>
            <div class="schedule-table-wrapper">
                <table class="amortization-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Date</th>
                            <th>Interest</th>
                            <th>Principal</th>
                            <th>Ending Balance</th>
                        </tr>
                    </thead>
                    <tbody id="amortization-tbody">
                        </tbody>
                </table>
            </div>
        </div>
        
        <section class="more-tools-section">
            <h2>More Tools</h2>
            <div class="tools-grid">
                <div>
                    <h3>Financial Calculators</h3>
                    <div class="links-container">
                        <a href="../../financial-calculators/home-affordability-calculator/">Home Affordability Calculators</a>
                        <a href="../../coming-soon/">Refinance Calculator</a>
                        <a href="../../coming-soon/">Loan Calculator</a>
                        <a href="../../financial-calculators/rent-vs-buy-calculator/">Rent v/s Buy Calculator</a>
                    </div>
                </div>
                <div>
                    <h3>Life Insurance</h3>
                    <div class="links-container">
                        <a href="../../coming-soon/">Life Insurance Calculator</a>
                        <a href="../../coming-soon/">Term v/s Whole Life Insurance Calculator</a>
                    </div>
                </div>
                <div>
                    <h3>Finance and Taxes</h3>
                    <div class="links-container">
                        <a href="../../coming-soon/">Credit Card Payoff Calculators</a>
                        <a href="../../coming-soon/">Debt Snowball Calculator</a>
                        <a href="../../coming-soon/">APR v/s Interest Rate Calculator</a>
                        <a href="../../coming-soon/">Credit Card Utilization Calculator</a>
                    </div>
                </div>
                <div>
                    <h3>Real Estate Investment</h3>
                    <div class="links-container">
                        <a href="../../coming-soon/">Cap Rate Calculator</a>
                        <a href="../../coming-soon/">ROI Calculator for Rental Property</a>
                        <a href="../../coming-soon/">Cash-on-Cash Return Calculator</a>
                        <a href="../../coming-soon/">Property Tax Calculator</a>
                        <a href="../../coming-soon/">Closing Costs Calculator</a>
                    </div>
                </div>
            </div>
        </section>

        <section class="seo-content-section">
            <h2>How to Use Our Mortgage Calculator: A Step-by-Step Guide</h2>
            <p>To get the most accurate estimate, follow these steps:</p>
            <ol>
                <li>
                    Enter Home Price: Input the total purchase price of the property youâ€™re considering.
                </li>
                <li>
                    Provide Down Payment: Enter the amount of cash you will pay upfront. A larger down payment reduces your loan amount and can help you avoid Private Mortgage Insurance (PMI).
                </li>
                <li>
                    Select Loan Term: Choose the length of your loan, typically 15 or 30 years. Shorter terms have higher monthly payments but save significantly on total interest.
                </li>
                <li>
                    Set the Interest Rate: Enter the Annual Percentage Rate (APR) from your lender. Even small changes here can dramatically impact your total cost.
                </li>
                <li>
                    Choose a Start Date: Select the month and year your loan is expected to begin to generate an accurate amortization schedule.
                </li>
                <li>
                    Add Annual Housing Costs: Enter estimates for your yearly property taxes and homeowners insurance. These are often paid monthly via an escrow account.
                </li>
                <li>
                    Include Other Fees: Add any monthly Private Mortgage Insurance (PMI) if your down payment is below 20%, as well as any Homeowners Association (HOA) fees.
                </li>
                <li>
                    Enter Your Financials: Provide your gross monthly income and total recurring monthly debts to calculate your Debt-to-Income (DTI) ratio.
                </li>
            </ol>

            <h2>Understanding Your Mortgage Results</h2>
             <p>Your results provide a complete financial picture of your potential loan, including these key metrics:</p>
            <ul>
                <li>Monthly Mortgage Payment (P&I): The core of your payment, covering your loan balance (Principal) and the cost of borrowing (Interest).</li>
                <li>Total Monthly Payment: Your all-in monthly housing cost, which includes P&I plus property taxes, insurance, PMI, and any HOA fees.</li>
                <li>Total Interest Paid: The cumulative interest you will pay over the entire life of the loan.</li>
                <li>Debt-to-Income (DTI) Ratio: The percentage of your gross income used for all debt payments. Lenders use this to assess affordability.</li>
                <li>Cash to Close: The total upfront cash needed on closing day, which combines your down payment and estimated closing costs.</li>
                <li>Amortization Schedule: A detailed table showing how each payment is applied to interest vs. principal, and your remaining balance over time.</li>
                <li>Visual Charts & Graphs: Interactive charts that illustrate your lifetime costs, equity growth, and loan amortization timeline at a glance.</li>
            </ul>

            <div class="faq-section">
                <h2>Frequently Asked Questions (FAQ)</h2>
                <details>
                    <summary>Q1: What costs are included in a mortgage payment?</summary>
                    <div class="faq-answer">
                        A1: A mortgage payment typically consists of PITI: Principal, Interest, Taxes, and Insurance. It may also include Private Mortgage Insurance (PMI) if your down payment is less than 20%, plus any monthly HOA fees.
                    </div>
                </details>
                <details>
                    <summary>Q2: What is the difference between a 15-year and 30-year mortgage?</summary>
                    <div class="faq-answer">
                        A2: A 30-year mortgage offers lower monthly payments but costs more in total interest. A 15-year mortgage has higher monthly payments, but you build equity faster and pay significantly less in total interest.
                    </div>
                </details>
                <details>
                    <summary>Q3: What is PMI and how can I avoid it?</summary>
                    <div class="faq-answer">
                        A3: Private Mortgage Insurance (PMI) protects the lender if your down payment is less than 20%. You can avoid it by making a larger down payment. PMI is usually removed once your home equity reaches 20%.
                    </div>
                </details>
                <details>
                    <summary>Q4: What is 'cash to close'?</summary>
                    <div class="faq-answer">
                        A4: "Cash to close" is the total amount of money you need on closing day. It includes your down payment plus closing costs (e.g., appraisal fees, title insurance, loan origination fees).
                    </div>
                </details>
                <details>
                    <summary>Q5: What is a DTI ratio and why is it important?</summary>
                    <div class="faq-answer">
                        A5: Your Debt-to-Income (DTI) ratio compares your total monthly debts to your gross monthly income. Lenders view it as a key indicator of your ability to manage payments, and a lower DTI can improve your chances of approval and help you secure better loan terms.
                    </div>
                </details>
                <details>
                    <summary>Q6: How can I reduce the total interest I pay on my mortgage?</summary>
                    <div class="faq-answer">
                        A6: You can reduce total interest by making extra principal payments, choosing a shorter loan term, improving your credit score to get a lower rate, or refinancing if interest rates drop.
                    </div>
                </details>
                <details>
                    <summary>Q7: Does this calculator guarantee loan approval?</summary>
                    <div class="faq-answer">
                        A7: No. This tool provides a reliable estimate for planning purposes. Final loan approval and terms depend on a lender's formal underwriting process, which includes verifying your credit, income, assets, and the property appraisal.
                    </div>
                </details>
            </div>
            
            <h2>Key Takeaway</h2>
            <p>Use our mortgage calculator to plan confidently, see your realistic monthly payments, understand total loan costs, and explore different scenarios before committing. Itâ€™s your essential tool for budgeting, comparing options, and achieving long-term financial stability.</p>

        </section>

    </main>
    
    <div id="chartTooltip" class="chart-tooltip"></div>
    
    <div id="details-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Lifetime Cost Breakdown</h3>
                <button class="modal-close-btn">&times;</button>
            </div>
            <div class="modal-breakdown-container" id="modal-breakdown-content">
            </div>
        </div>
    </div>

    <footer>
        <a href="../../about/">About</a>
        <a href="../../contact/">Contact Us</a>
        <a href="../../terms-of-use/">Terms of Use</a>
        <a href="../../privacy-policy/">Privacy Policy</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const inputCaps = {
                homePrice: 10000000000,
                downPayment: 10000000000,
                loanTerm: 100,
                interestRate: 100,
                startDateYear: 9999,
                homeInsurance: 1000000000,
                hoaFee: 1000000,
                propertyTaxes: 1000000000,
                otherCosts: 1000000,
                pmiInsurance: 1000000000,
                monthlyDebts: 1000000000,
                closingCosts: 1000000000,
                appreciationRate: 100,
                monthlyIncome: 1000000000,
            };

            for (const id in inputCaps) {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', () => {
                        const parsedValue = parseFloat(input.value);
                        if (!isNaN(parsedValue) && parsedValue > inputCaps[id]) {
                            input.value = inputCaps[id].toString();
                        }
                    });
                }
            }

            let costBreakdownChart, loanAmortizationChart, homeEquityChart;
            let fullAmortizationData = [];
            let pieChartRawData = {};

            const showDetailsBtn = document.getElementById('show-details-btn');
            const detailsModal = document.getElementById('details-modal');
            const modalCloseBtn = detailsModal.querySelector('.modal-close-btn');

            const allInputs = {
                homePrice: document.getElementById('homePrice'),
                downPayment: document.getElementById('downPayment'),
                loanTerm: document.getElementById('loanTerm'),
                interestRate: document.getElementById('interestRate'),
                propertyTaxes: document.getElementById('propertyTaxes'),
                homeInsurance: document.getElementById('homeInsurance'),
                pmiInsurance: document.getElementById('pmiInsurance'),
                hoaFee: document.getElementById('hoaFee'),
                closingCosts: document.getElementById('closingCosts'),
                otherCosts: document.getElementById('otherCosts'),
                monthlyIncome: document.getElementById('monthlyIncome'),
                monthlyDebts: document.getElementById('monthlyDebts'),
                creditScore: document.getElementById('creditScore'),
                appreciationRate: document.getElementById('appreciationRate'),
                day: document.getElementById('startDateDay'),
                month: document.getElementById('startDateMonth'),
                year: document.getElementById('startDateYear')
            };

            const resultElements = {
                loanAmount: document.getElementById('resultLoanAmount'),
                totalInterest: document.getElementById('resultTotalInterest'),
                cashToClose: document.getElementById('resultCashToClose'),
                dtiRatio: document.getElementById('resultDtiRatio'),
                summaryText: document.getElementById('resultSummaryText'),
                contextualAdvice: document.getElementById('contextual-advice'),
                fiveYearText: document.getElementById('fiveYearText'),
                monthlyMortgage: document.getElementById('monthlyMortgage'),
                monthlyInsurance: document.getElementById('monthlyInsurance'),
                monthlyHOA: document.getElementById('monthlyHOA'),
                monthlyTotal: document.getElementById('monthlyTotal'),
                monthlyTax: document.getElementById('monthlyTax'),
                monthlyPMI: document.getElementById('monthlyPMI'),
                monthlyOther: document.getElementById('monthlyOther'),
                totalMortgage: document.getElementById('totalMortgage'),
                totalInsurance: document.getElementById('totalInsurance'),
                totalHOA: document.getElementById('totalHOA'),
                totalTotal: document.getElementById('totalTotal'),
                totalTax: document.getElementById('totalTax'),
                totalPMI: document.getElementById('totalPMI'),
                totalOther: document.getElementById('totalOther'),
            };
            const scheduleElements = {
                yearlyBtn: document.getElementById('yearly-btn'),
                monthlyBtn: document.getElementById('monthly-btn'),
                tbody: document.getElementById('amortization-tbody')
            };

            const sanitizeDecimal = (event) => {
                let value = event.target.value;
                let sanitized = value.replace(/[^0-9.]/g, '');
                const parts = sanitized.split('.');
                if (parts.length > 2) {
                    sanitized = parts[0] + '.' + parts.slice(1).join('');
                }
                event.target.value = sanitized;
            };

            const validateDate = () => {
                let day = parseInt(allInputs.day.value);
                let month = parseInt(allInputs.month.value);
                let year = parseInt(allInputs.year.value);
                if (!isNaN(month)) {
                    if (month > 12) allInputs.month.value = '12';
                    else if (month < 1 && allInputs.month.value.length > 0) allInputs.month.value = '1';
                }
                if (!isNaN(day) && !isNaN(month) && !isNaN(year) && year.toString().length >= 4) {
                    const daysInMonth = new Date(year, month, 0).getDate();
                    if (day > daysInMonth) allInputs.day.value = daysInMonth;
                }
                if (!isNaN(day) && day < 1 && allInputs.day.value.length > 0) {
                    allInputs.day.value = '1';
                }
            };

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                }).format(value);
            };
            
            const debounce = (func, delay) => {
                let timeout;
                return function(...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), delay);
                };
            };

            const populateDetailsModal = () => {
                const contentEl = document.getElementById('modal-breakdown-content');
                contentEl.innerHTML = '';

                const total = Object.values(pieChartRawData).reduce((acc, val) => acc + (val || 0), 0);

                let html = `
                    <div class="modal-breakdown-header">
                        <span>Component</span>
                        <span>Percent</span>
                        <span>Amount</span>
                    </div>
                `;

                if (total === 0) {
                    contentEl.innerHTML = '<p style="text-align: center; color: #666;">No data to display. Please enter your details in the calculator.</p>';
                    return;
                }

                for (const label in pieChartRawData) {
                    const value = pieChartRawData[label] || 0;
                    const percentage = ((value / total) * 100).toFixed(1);
                    
                    html += `
                        <div class="result-item">
                            <span class="label">${label}</span>
                            <span class="percentage">${percentage}%</span>
                            <span class="value">${formatCurrency(value)}</span>
                        </div>
                    `;
                }

                contentEl.innerHTML = html;
            };
            
            const customTooltipHandler = (event, chart) => {
                const tooltipEl = document.getElementById('chartTooltip');
                const { pageX, pageY } = event;
                const elements = chart.getElementsAtEventForMode(event, 'nearest', { intersect: false }, true);

                if (elements.length === 0) {
                    if (event.type === 'mouseout') {
                        tooltipEl.style.opacity = 0;
                    }
                    return false;
                }

                const element = elements[0];
                const { datasetIndex, index } = element;
                const data = chart.data;

                let innerHtml = '';
                
                if (chart.canvas.id === 'costBreakdownChart') {
                    const label = data.labels[index] || '';
                    const value = data.datasets[datasetIndex].data[index];
                    const total = data.datasets[datasetIndex].data.reduce((acc, current) => acc + current, 0);
                    const percentage = total > 0 ? ((value / total) * 100).toFixed(0) : 0;
                    innerHtml = `
                        <div class="tooltip-title">${label}</div>
                        <div style="text-align: center;">${formatCurrency(value)} (${percentage}%)</div>
                    `;
                } else {
                    const title = data.labels[index] || '';
                    if (title) {
                        innerHtml += `<div class="tooltip-title">Year: ${title}</div>`;
                    }
                    chart.getElementsAtEventForMode(event, 'index', { intersect: false }).forEach(point => {
                        const { datasetIndex, index } = point;
                        const dataset = data.datasets[datasetIndex];
                        const label = dataset.label;
                        const value = dataset.data[index];
                        const color = dataset.borderColor;
                        innerHtml += `
                            <div class="tooltip-body-item">
                                <div style="display: flex; align-items: center;">
                                    <span class="tooltip-color-box" style="background-color: ${color}"></span>
                                    <span>${label}:</span>
                                </div>
                                <span>${formatCurrency(value)}</span>
                            </div>
                        `;
                    });
                }

                tooltipEl.innerHTML = innerHtml;
                tooltipEl.style.opacity = 1;

                const tooltipWidth = tooltipEl.offsetWidth;
                const tooltipHeight = tooltipEl.offsetHeight;
                const margin = 15;
                let finalX, finalY;

                finalY = pageY + margin;
                if (finalY + tooltipHeight + margin > window.innerHeight) {
                    finalY = pageY - tooltipHeight - margin;
                }
                if (finalY < 0) {
                    finalY = margin;
                }

                finalX = pageX + margin;
                if (finalX + tooltipWidth + margin > window.innerWidth) {
                    finalX = pageX - tooltipWidth - margin;
                    if (finalX < 0) {
                        finalX = pageX - (tooltipWidth / 2);
                    }
                }
                
                if (finalX < 0) {
                    finalX = margin;
                }
                if (finalX + tooltipWidth + margin > window.innerWidth) {
                    finalX = window.innerWidth - tooltipWidth - margin;
                }

                tooltipEl.style.left = finalX + 'px';
                tooltipEl.style.top = finalY + 'px';
                
                return true;
            };


            const initializeCharts = () => {
                const pieCtx = document.getElementById('costBreakdownChart').getContext('2d');
                const amortizationCtx = document.getElementById('loanAmortizationChart').getContext('2d');
                const equityCtx = document.getElementById('homeEquityChart').getContext('2d');

                [costBreakdownChart, loanAmortizationChart, homeEquityChart].forEach(chart => {
                    if (chart) chart.destroy();
                });

                costBreakdownChart = new Chart(pieCtx, {
                    type: 'pie', data: { labels: [], datasets: [{ data: [], backgroundColor: ['#d3b892', '#e4d3b8', '#fff3e0', '#c8a87e', '#b28e68', '#a07c5a'], borderWidth: 0 }] },
                    options: { responsive: true, maintainAspectRatio: true, plugins: { legend: { display: false }, tooltip: { enabled: false } }, interaction: { mode: 'nearest', intersect: false } }
                });

                const lineChartOptions = {
                    responsive: true, maintainAspectRatio: true,
                    scales: { y: { ticks: { callback: value => '$' + (value / 1000) + 'k' } } },
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    interaction: { mode: 'index', intersect: false }
                };

                loanAmortizationChart = new Chart(amortizationCtx, {
                    type: 'line',
                    data: { labels: [], datasets: [
                        { label: 'Balance', data: [], borderColor: '#8c5a3c', backgroundColor: 'rgba(140, 90, 60, 0.2)', fill: true, tension: 0.4, pointRadius: 0 },
                        { label: 'Principal Paid', data: [], borderColor: '#d3b892', backgroundColor: 'rgba(211, 184, 146, 0.3)', fill: true, tension: 0.4, pointRadius: 0 },
                        { label: 'Interest', data: [], borderColor: '#d09a7a', backgroundColor: 'rgba(208, 154, 122, 0.3)', fill: true, tension: 0.4, pointRadius: 0 },
                    ]},
                    options: lineChartOptions
                });

                homeEquityChart = new Chart(equityCtx, {
                    type: 'line',
                    data: { labels: [], datasets: [
                        { label: 'Home Value', data: [], borderColor: '#8c5a3c', backgroundColor: 'rgba(140, 90, 60, 0.1)', fill: true, tension: 0.4, pointRadius: 0 },
                        { label: 'Equity', data: [], borderColor: '#d09a7a', backgroundColor: 'rgba(208, 154, 122, 0.3)', fill: true, tension: 0.4, pointRadius: 0 },
                        { label: 'Loan Balance', data: [], borderColor: '#d3b892', backgroundColor: 'rgba(211, 184, 146, 0.2)', fill: true, tension: 0.4, pointRadius: 0 },
                    ]},
                    options: lineChartOptions
                });

                const charts = [costBreakdownChart, loanAmortizationChart, homeEquityChart];
                charts.forEach(chart => {
                    chart.canvas.addEventListener('mousemove', (e) => customTooltipHandler(e, chart));
                    chart.canvas.addEventListener('mouseout', () => {
                        document.getElementById('chartTooltip').style.opacity = 0;
                    });
                    chart.canvas.addEventListener('click', (e) => {
                        e.stopPropagation();
                        customTooltipHandler(e, chart);
                    });
                });
            };

            const calculateAndDisplay = () => {
                const homePrice = parseFloat(allInputs.homePrice.value) || 0;
                let downPayment = parseFloat(allInputs.downPayment.value) || 0;

                if (downPayment > homePrice) {
                    downPayment = homePrice;
                    allInputs.downPayment.value = homePrice.toString();
                }
                
                const loanTerm = parseFloat(allInputs.loanTerm.value) || 0;
                const interestRate = parseFloat(allInputs.interestRate.value) || 0;
                const propertyTaxes = parseFloat(allInputs.propertyTaxes.value) || 0;
                const homeInsurance = parseFloat(allInputs.homeInsurance.value) || 0;
                const pmiInsurance = parseFloat(allInputs.pmiInsurance.value) || 0;
                const hoaFee = parseFloat(allInputs.hoaFee.value) || 0;
                const closingCosts = parseFloat(allInputs.closingCosts.value) || 0;
                const otherCosts = parseFloat(allInputs.otherCosts.value) || 0;
                const monthlyIncome = parseFloat(allInputs.monthlyIncome.value) || 0;
                const monthlyDebts = parseFloat(allInputs.monthlyDebts.value) || 0;
                const creditScore = allInputs.creditScore.value;
                const appreciationRate = parseFloat(allInputs.appreciationRate.value) / 100 || 0;
                const startDay = parseInt(allInputs.day.value) || 1;
                const startMonth = parseInt(allInputs.month.value) || 1;
                const startYear = parseInt(allInputs.year.value) || new Date().getFullYear();
                const startDate = new Date(startYear, startMonth - 1, startDay);
                
                const principal = homePrice - downPayment;
                if (principal <= 0) { return; }
                const monthlyInterestRate = interestRate / 100 / 12;
                const numberOfPayments = loanTerm * 12;
                let monthlyPI = principal * (monthlyInterestRate * Math.pow(1 + monthlyInterestRate, numberOfPayments)) / (Math.pow(1 + monthlyInterestRate, numberOfPayments) - 1) || 0;
                const totalInterest = (monthlyPI * numberOfPayments) - principal;

                const monthlyTax = propertyTaxes / 12;
                const monthlyInsurance = homeInsurance / 12;
                const monthlyPMI = pmiInsurance / 12;
                const monthlyTotal = monthlyPI + monthlyTax + monthlyInsurance + monthlyPMI + hoaFee + otherCosts;

                const totalMonthlyDebtPayment = monthlyTotal + monthlyDebts;
                const dtiRatio = monthlyIncome > 0 ? (totalMonthlyDebtPayment / monthlyIncome) : 0;

                const totalMortgage = monthlyPI * numberOfPayments;
                const totalTax = monthlyTax * numberOfPayments;
                const totalInsurance = monthlyInsurance * numberOfPayments;
                const totalPMI = monthlyPMI * numberOfPayments;
                const totalHOA = hoaFee * numberOfPayments;
                const totalOther = otherCosts * numberOfPayments;
                const totalOutOfPocket = downPayment + totalMortgage + totalTax + totalInsurance + totalPMI + totalHOA + totalOther + closingCosts;
                
                const cashToClose = downPayment + closingCosts;

                resultElements.loanAmount.textContent = formatCurrency(principal);
                resultElements.totalInterest.textContent = formatCurrency(totalInterest > 0 ? totalInterest : 0);
                resultElements.cashToClose.textContent = formatCurrency(cashToClose);
                resultElements.dtiRatio.textContent = (dtiRatio * 100).toFixed(1) + '%';
                resultElements.summaryText.innerHTML = `Over the course of your <span class="summary-highlight">${loanTerm}</span> year loan, your total out-of-pocket cost is estimated to be <span class="summary-highlight">${formatCurrency(totalOutOfPocket)}</span>, with <span class="summary-highlight">${formatCurrency(totalInterest > 0 ? totalInterest : 0)}</span> going towards interest.`;
                resultElements.monthlyTotal.textContent = formatCurrency(monthlyTotal);
                resultElements.totalTotal.textContent = formatCurrency(totalOutOfPocket);
                resultElements.monthlyMortgage.textContent = formatCurrency(monthlyPI);
                resultElements.monthlyTax.textContent = formatCurrency(monthlyTax);
                resultElements.monthlyInsurance.textContent = formatCurrency(monthlyInsurance);
                resultElements.monthlyPMI.textContent = formatCurrency(monthlyPMI);
                resultElements.monthlyHOA.textContent = formatCurrency(hoaFee);
                resultElements.monthlyOther.textContent = formatCurrency(otherCosts);
                resultElements.totalMortgage.textContent = formatCurrency(totalMortgage);
                resultElements.totalTax.textContent = formatCurrency(totalTax);
                resultElements.totalInsurance.textContent = formatCurrency(totalInsurance);
                resultElements.totalPMI.textContent = formatCurrency(totalPMI);
                resultElements.totalHOA.textContent = formatCurrency(totalHOA);
                resultElements.totalOther.textContent = formatCurrency(totalOther);

                fullAmortizationData = generateFullAmortizationSchedule(principal, monthlyInterestRate, numberOfPayments, monthlyPI, startDate);

                if (fullAmortizationData.length >= 60) {
                    const fiveYearChunk = fullAmortizationData.slice(0, 60);
                    const fiveYearInterest = fiveYearChunk.reduce((acc, month) => acc + month.interest, 0);
                    const fiveYearPrincipal = fiveYearChunk.reduce((acc, month) => acc + month.principal, 0);
                    resultElements.fiveYearText.innerHTML = `You will pay <span class="summary-highlight">${formatCurrency(fiveYearInterest)}</span> in interest and <span class="summary-highlight">${formatCurrency(fiveYearPrincipal)}</span> towards your principal. Your remaining balance will be <span class="summary-highlight">${formatCurrency(fiveYearChunk[59].balance)}</span>.`;
                } else {
                    resultElements.fiveYearText.textContent = "Loan term is less than five years.";
                }

                let advice = '';
                if (dtiRatio > 0.43) {
                    advice += `<p>High DTI Ratio: Your debt-to-income ratio of ${(dtiRatio * 100).toFixed(1)}% is considered high. Lenders typically prefer a DTI below 43%. This could make it more difficult to qualify for a loan.</p>`;
                } else if (dtiRatio > 0.36) {
                    advice += `<p>Good DTI Ratio: Your DTI of ${(dtiRatio * 100).toFixed(1)}% is in a healthy range, but keeping it lower can improve your loan options.</p>`;
                }
                if (creditScore === 'fair' || creditScore === 'poor') {
                    advice += `<p>Credit Score Tip: You've selected a lower credit score tier. Improving your credit score before applying for a mortgage can often result in a lower interest rate, saving you thousands over the life of the loan.</p>`;
                }
                resultElements.contextualAdvice.innerHTML = advice;
                resultElements.contextualAdvice.style.display = advice ? 'block' : 'none';
                
                const pieChartData = {
                    'Total Interest': totalInterest, 'Principal': principal, 'Property Taxes & Other': totalTax + totalOther + totalPMI + totalHOA, 
                    'Home Insurance': totalInsurance, 'Closing Costs': closingCosts, 'Down Payment': downPayment
                };

                pieChartRawData = pieChartData;

                const amortizationData = calculateAmortizationForChart(fullAmortizationData, loanTerm);
                const equityData = calculateEquityForChart(homePrice, appreciationRate, fullAmortizationData, loanTerm);
                updateCharts(pieChartData, amortizationData, equityData, loanTerm);

                renderAmortizationTable();
            };

            const calculateAmortizationForChart = (schedule, loanTerm) => {
                const labels = []; const balanceData = [schedule[0]?.balance + schedule[0]?.principal || 0];
                const interestData = [0]; const principalData = [0];
                let totalInterestPaid = 0; let totalPrincipalPaid = 0;

                schedule.forEach((item, index) => {
                    totalInterestPaid += item.interest;
                    totalPrincipalPaid += item.principal;
                    if ((index + 1) % 12 === 0 || (index + 1) === schedule.length) {
                        labels.push(Math.ceil((index + 1) / 12));
                        balanceData.push(item.balance);
                        interestData.push(totalInterestPaid);
                        principalData.push(totalPrincipalPaid);
                    }
                });
                return { labels, balanceData, interestData, principalData };
            };
            
            const calculateEquityForChart = (homePrice, appreciationRate, schedule, loanTerm) => {
                const labels = []; const valueData = [homePrice]; const balanceData = [schedule[0]?.balance + schedule[0]?.principal || 0]; const equityData = [homePrice - balanceData[0]];
                let currentValue = homePrice;

                for (let year = 1; year <= loanTerm; year++) {
                    labels.push(year);
                    currentValue *= (1 + appreciationRate);
                    const monthIndex = Math.min(year * 12 - 1, schedule.length - 1);
                    const currentBalance = schedule[monthIndex]?.balance || 0;
                    
                    valueData.push(currentValue);
                    balanceData.push(currentBalance);
                    equityData.push(currentValue - currentBalance);
                }
                return { labels, valueData, balanceData, equityData };
            };

            const generateFullAmortizationSchedule = (principal, monthlyRate, numPayments, monthlyPI, startDate) => { 
                let balance = principal;
                const schedule = [];
                for (let i = 1; i <= numPayments; i++) {
                    const interestPayment = balance * monthlyRate;
                    const principalPayment = monthlyPI - interestPayment;
                    balance -= principalPayment;
                    const paymentDate = new Date(startDate);
                    paymentDate.setMonth(paymentDate.getMonth() + i);
                    schedule.push({
                        paymentNumber: i,
                        date: paymentDate,
                        interest: interestPayment,
                        principal: principalPayment,
                        balance: balance > 0 ? balance : 0,
                    });
                }
                return schedule;
            };

            const renderAmortizationTable = () => { 
                 const tbody = scheduleElements.tbody;
                tbody.innerHTML = '';
                const isMonthly = scheduleElements.monthlyBtn.classList.contains('active');

                if (isMonthly) {
                    fullAmortizationData.forEach(item => {
                        const row = tbody.insertRow();
                        const dateFormatted = new Intl.DateTimeFormat('en-US', { month: 'short', year: 'numeric' }).format(item.date);
                        row.innerHTML = `<td>${Math.ceil(item.paymentNumber / 12)}</td><td>${dateFormatted}</td><td>${formatCurrency(item.interest)}</td><td>${formatCurrency(item.principal)}</td><td>${formatCurrency(item.balance)}</td>`;
                    });
                } else { 
                    const yearlyData = [];
                    for (let i = 0; i < fullAmortizationData.length; i += 12) {
                        const yearChunk = fullAmortizationData.slice(i, i + 12);
                        if (yearChunk.length === 0) continue;
                        const yearSummary = yearChunk.reduce((acc, month) => {
                            acc.interest += month.interest;
                            acc.principal += month.principal;
                            return acc;
                        }, { interest: 0, principal: 0 });
                        
                        yearlyData.push({
                            year: Math.ceil(yearChunk[0].paymentNumber / 12),
                            date: yearChunk[yearChunk.length-1].date.getFullYear(),
                            interest: yearSummary.interest,
                            principal: yearSummary.principal,
                            balance: yearChunk[yearChunk.length-1].balance,
                        });
                    }
                    yearlyData.forEach(item => {
                        const row = tbody.insertRow();
                        row.innerHTML = `<td>${item.year}</td><td>${item.date}</td><td>${formatCurrency(item.interest)}</td><td>${formatCurrency(item.principal)}</td><td>${formatCurrency(item.balance)}</td>`;
                    });
                }
            };

            const updateCharts = (pieData, amortizationData, equityData, loanTerm) => {
                const pieLabels = Object.keys(pieData);
                const pieValues = Object.values(pieData);
                costBreakdownChart.data.labels = pieLabels;
                costBreakdownChart.data.datasets[0].data = pieValues;
                costBreakdownChart.update();
                updateCustomLegend('cost-breakdown-legend', costBreakdownChart);
                
                loanAmortizationChart.data.labels = amortizationData.labels || [];
                loanAmortizationChart.data.datasets[0].data = amortizationData.balanceData || [];
                loanAmortizationChart.data.datasets[1].data = amortizationData.principalData || [];
                loanAmortizationChart.data.datasets[2].data = amortizationData.interestData || [];
                loanAmortizationChart.update();
                updateCustomLegend('amortization-legend', loanAmortizationChart);

                homeEquityChart.data.labels = equityData.labels || [];
                homeEquityChart.data.datasets[0].data = equityData.valueData || [];
                homeEquityChart.data.datasets[1].data = equityData.equityData || [];
                homeEquityChart.data.datasets[2].data = equityData.balanceData || [];
                homeEquityChart.update();
                updateCustomLegend('equity-legend', homeEquityChart);
            };

            const updateCustomLegend = (containerId, chart) => {
                const legendContainer = document.getElementById(containerId);
                legendContainer.innerHTML = '';
                const isPie = chart.config.type === 'pie';
                const datasets = chart.data.datasets;

                if (isPie) {
                    const labels = chart.data.labels;
                    const colors = datasets[0].backgroundColor;
                    labels.forEach((label, index) => {
                        const legendItem = document.createElement('div');
                        legendItem.className = 'legend-item';
                        legendItem.innerHTML = `<div class="legend-color-box" style="background-color: ${colors[index]}"></div><span>${label}</span>`;
                        legendContainer.appendChild(legendItem);
                    });
                } else {
                    datasets.forEach(dataset => {
                        const legendItem = document.createElement('div');
                        legendItem.className = 'legend-item';
                        legendItem.innerHTML = `<div class="legend-color-box" style="background-color: ${dataset.borderColor}"></div><span>${dataset.label}</span>`;
                        legendContainer.appendChild(legendItem);
                    });
                }
            };
            
            const handleResize = () => { 
                if (costBreakdownChart) costBreakdownChart.destroy();
                if (loanAmortizationChart) loanAmortizationChart.destroy();
                if (homeEquityChart) homeEquityChart.destroy();
                initializeCharts();
                calculateAndDisplay();
            };

            function initializeCustomSelect() {
                const wrapper = document.querySelector(".custom-select-wrapper");
                if (!wrapper) return;
                
                const selectEl = wrapper.querySelector("select");
                const selectedDiv = document.createElement("div");
                selectedDiv.setAttribute("class", "select-selected");
                selectedDiv.innerHTML = selectEl.options[selectEl.selectedIndex].innerHTML;
                wrapper.appendChild(selectedDiv);
                
                const optionsListDiv = document.createElement("div");
                optionsListDiv.setAttribute("class", "select-items select-hide");
                
                for (let i = 0; i < selectEl.length; i++) {
                    const optionDiv = document.createElement("div");
                    optionDiv.innerHTML = selectEl.options[i].innerHTML;
                    
                    if (i === selectEl.selectedIndex) {
                        optionDiv.setAttribute("class", "same-as-selected");
                    }

                    optionDiv.addEventListener("click", function() {
                        const s = this.parentNode.parentNode.querySelector("select");
                        const sl = this.parentNode.previousSibling;
                        for (let j = 0; j < s.length; j++) {
                            if (s.options[j].innerHTML == this.innerHTML) {
                                s.selectedIndex = j;
                                sl.innerHTML = this.innerHTML;
                                const y = this.parentNode.getElementsByClassName("same-as-selected");
                                for (let k = 0; k < y.length; k++) {
                                    y[k].removeAttribute("class");
                                }
                                this.setAttribute("class", "same-as-selected");
                                break;
                            }
                        }
                        sl.click();
                        s.dispatchEvent(new Event('change'));
                    });
                    optionsListDiv.appendChild(optionDiv);
                }
                wrapper.appendChild(optionsListDiv);
                
                selectedDiv.addEventListener("click", function(e) {
                    e.stopPropagation();
                    closeAllSelect(this);
                    this.nextSibling.classList.toggle("select-hide");
                    this.classList.toggle("select-arrow-active");
                });
            }

            function closeAllSelect(elmnt) {
                const items = document.getElementsByClassName("select-items");
                const selected = document.getElementsByClassName("select-selected");
                for (let i = 0; i < selected.length; i++) {
                    if (elmnt == selected[i]) {
                    } else {
                        selected[i].classList.remove("select-arrow-active");
                    }
                }
                for (let i = 0; i < items.length; i++) {
                    if (elmnt.nextSibling != items[i]) {
                        items[i].classList.add("select-hide");
                    }
                }
            }

            document.addEventListener("click", (e) => {
                closeAllSelect(e.target);
                const isChartClick = e.target.closest('.chart-wrapper');
                const tooltipEl = document.getElementById('chartTooltip');
                
                if (!isChartClick && !e.target.closest('.chart-tooltip') && tooltipEl.style.opacity === '1') {
                     tooltipEl.style.opacity = 0;
                }
            });

            Object.values(allInputs).forEach(input => {
                if(input.id !== 'creditScore') input.addEventListener('input', calculateAndDisplay)
            });
            allInputs.creditScore.addEventListener('change', calculateAndDisplay);

             [ allInputs.homePrice, allInputs.downPayment, allInputs.propertyTaxes, allInputs.homeInsurance, allInputs.pmiInsurance, 
               allInputs.hoaFee, allInputs.otherCosts, allInputs.closingCosts, allInputs.monthlyIncome, allInputs.monthlyDebts, allInputs.appreciationRate
             ].forEach(input => input.addEventListener('input', sanitizeDecimal));
            
            [allInputs.day, allInputs.month, allInputs.year].forEach(input => input.addEventListener('input', validateDate));
            
            scheduleElements.yearlyBtn.addEventListener('click', () => {
                scheduleElements.yearlyBtn.classList.add('active');
                scheduleElements.monthlyBtn.classList.remove('active');
                renderAmortizationTable();
            });
            scheduleElements.monthlyBtn.addEventListener('click', () => {
                scheduleElements.monthlyBtn.classList.add('active');
                scheduleElements.yearlyBtn.classList.remove('active');
                renderAmortizationTable();
            });

            showDetailsBtn.addEventListener('click', () => {
                populateDetailsModal();
                detailsModal.style.display = 'flex';
            });

            modalCloseBtn.addEventListener('click', () => {
                detailsModal.style.display = 'none';
            });

            detailsModal.addEventListener('click', (e) => {
                if (e.target === detailsModal) {
                    detailsModal.style.display = 'none';
                }
            });

            window.addEventListener('resize', debounce(handleResize, 250));
            
            initializeCharts();
            validateDate();
            initializeCustomSelect(); 
            calculateAndDisplay();

            const taglines = [
                "Precision today, ownership tomorrow.",
                "Your future, calculated with care.",
                "Estimate with elegance, decide with confidence.",
                "Calculations today, keys in hand tomorrow.",
                "Scroll down to unlock your monthly payment."
            ];
            let taglineIndex = 0;
            const taglineElement = document.getElementById('looping-text');

            function cycleTaglines() {
                taglineElement.textContent = taglines[taglineIndex];
                taglineElement.style.opacity = '1';
                setTimeout(() => {
                    taglineElement.style.opacity = '0';
                    setTimeout(() => {
                        taglineIndex = (taglineIndex + 1) % taglines.length;
                        cycleTaglines();
                    }, 1500);
                }, 4000);
            }
            cycleTaglines();
            
            const scrollTaglines = [
                "The calculator is right below",
                "Scroll down to calculate",
                "Your answers are waiting below",
                "Begin your journey just beneath"
            ];
            let scrollTaglineIndex = 0;
            const scrollIndicator = document.querySelector('.scroll-indicator');
            const scrollTaglineElement = document.getElementById('scroll-looping-text');
            const scrollArrow = scrollIndicator.querySelector('img');

            const scrollTaglineWidths = [];
            const tempP = document.createElement('p');
            tempP.style.cssText = `font-size: 1rem; font-weight: 300; white-space: nowrap; position: absolute; top: -9999px; left: -9999px;`;
            document.body.appendChild(tempP);
            scrollTaglines.forEach(text => {
                tempP.textContent = text;
                scrollTaglineWidths.push(tempP.offsetWidth);
            });
            document.body.removeChild(tempP);

            function runNextScrollCycle() {
                scrollTaglineIndex = (scrollTaglineIndex + 1) % scrollTaglines.length;
                scrollTaglineElement.textContent = scrollTaglines[scrollTaglineIndex];

                setTimeout(() => {
                    const arrowWidth = scrollArrow.offsetWidth;
                    const gap = 15;
                    const currentTextWidth = scrollTaglineWidths[scrollTaglineIndex];
                    const totalWidth = arrowWidth + gap + currentTextWidth;
                    const newLeft = (window.innerWidth - totalWidth) / 2;
                    scrollIndicator.style.left = newLeft + 'px';

                    setTimeout(() => {
                        scrollTaglineElement.style.opacity = '1';
                        setTimeout(() => {
                            scrollTaglineElement.style.opacity = '0';
                            setTimeout(runNextScrollCycle, 1500);
                        }, 4000);
                    }, 500);
                }, 10);
            }

            function initialScrollAnimation() {
                scrollTaglineElement.style.opacity = '0';
                scrollTaglineElement.textContent = scrollTaglines[0];
                const arrowWidth = scrollArrow.offsetWidth;
                if (arrowWidth === 0) { 
                    setTimeout(initialScrollAnimation, 50);
                    return;
                }
                const initialLeft = (window.innerWidth - arrowWidth) / 2;
                scrollIndicator.style.transition = 'none';
                scrollIndicator.style.left = initialLeft + 'px';

                setTimeout(() => {
                    const gap = 15;
                    const firstTextWidth = scrollTaglineWidths[0];
                    const totalWidth = arrowWidth + gap + firstTextWidth;
                    const newLeft = (window.innerWidth - totalWidth) / 2;
                    scrollIndicator.style.transition = 'left 0.5s ease-in-out';
                    scrollIndicator.style.left = newLeft + 'px';

                    setTimeout(() => {
                        scrollTaglineElement.style.opacity = '1';
                        setTimeout(() => {
                            scrollTaglineElement.style.opacity = '0';
                            setTimeout(runNextScrollCycle, 1500);
                        }, 4000);
                    }, 500);
                }, 100);
            }
            initialScrollAnimation();

            const affordabilityNotes = [
                "Find out what you can truly afford.",
                "Calculate your realistic home budget.",
                "The first step to your new home."
            ];
            const rentBuyNotes = [
                "Is renting or buying right for you?",
                "Compare the long-term financial impact.",
                "Make the right choice for your future."
            ];

            const affordabilityNoteEl = document.getElementById('affordability-note');
            const rentBuyNoteEl = document.getElementById('rent-buy-note');
            let affordabilityIndex = 0;
            let rentBuyIndex = 0;

            function cycleNotes(element, notesArray, index) {
                if (!element) return;
                element.textContent = notesArray[index];
                element.style.opacity = '1';
                
                setTimeout(() => {
                    element.style.opacity = '0';
                    setTimeout(() => {
                        let nextIndex = (index + 1) % notesArray.length;
                        if (element.id === 'affordability-note') {
                            affordabilityIndex = nextIndex;
                            cycleNotes(element, notesArray, affordabilityIndex);
                        } else {
                            rentBuyIndex = nextIndex;
                            cycleNotes(element, notesArray, rentBuyIndex);
                        }
                    }, 1500);
                }, 4000);
            }

            cycleNotes(affordabilityNoteEl, affordabilityNotes, affordabilityIndex);
            setTimeout(() => {
                cycleNotes(rentBuyNoteEl, rentBuyNotes, rentBuyIndex);
            }, 2000);
        });
    </script>
</body>
</html>
